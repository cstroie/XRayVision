<!DOCTYPE html>
<html data-theme="dark" lang="en">
<!--
  XRayVision - Async DICOM processor with OpenAI and WebSocket dashboard.
  Copyright (C) 2025 Costin Stroie <costinstroie@eridu.eu.org>

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  any later version.
-->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="light dark">
    <title>XRayVision Report Check</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.colors.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.slate.min.css">
    <link rel="stylesheet" href="/static/styles.css">
    <link rel="icon" href="/static/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/static/favicon-64x64.png" type="image/png" sizes="64x64">
</head>
<body class="container">
    <nav>
        <ul>
            <li><strong>XRayVision Report Checker</strong></li>
        </ul>
        <ul>
            <li><a href="/">Dashboard</a></li>
            <li><a href="/stats">Statistics</a></li>
            <li><a href="/check" class="contrast">Check</a></li>
            <li><a href="/about">About</a></li>
        </ul>
    </nav>
    <main>
        <hgroup>
            <h2>Report Checker</h2>
            <p>Enter a radiology report to analyze for pathological findings</p>
        </hgroup>
        <header id="result">
            <article>
                <header>
                    <h3>Analysis Result</h3>
                </header>
                <main class="result-content">
                    <p><strong>Pathologic:</strong> <span id="pathologic"></span></p>
                    <p><strong>Severity:</strong> <span id="severity"></span></p>
                    <p><strong>Summary:</strong> <span id="summary"></span></p>
                </main>
            </article>
        </header>
        <form id="check-form">
            <fieldset>
                <label for="report-text">Radiology Report Text</label>
                <textarea id="report-text" name="report" placeholder="Enter radiology report text here..." rows="5" required></textarea>
                <button type="submit" form="check-form">Analyze Report</button>
            </fieldset>
        </form>
    </main>

    <script>
        document.getElementById("check-form").addEventListener("submit", function (e) {
            e.preventDefault();
            const reportText = document.getElementById("report-text").value.trim();
            
            if (!reportText) {
                alert("Please enter a report to analyze");
                return;
            }

            fetch('/api/check', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ report: reportText })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                document.getElementById("pathologic").textContent = data.pathologic;
                document.getElementById("severity").textContent = data.severity;
                document.getElementById("summary").textContent = data.summary;
                
                const resultElement = document.getElementById("result");
                resultElement.classList.add("show");
                resultElement.className = "show " + (data.pathologic === "yes" ? "pathologic-yes" : "pathologic-no");
                
                // Scroll to results
                resultElement.scrollIntoView({ behavior: "smooth" });
            })
            .catch(error => {
                console.error('Error:', error);
                alert("An error occurred while analyzing the report. Please try again.");});
        });
    </script>
</body>
</html>
